2025-04-26 21:37:21,188 - solr-mcp-server - INFO - Port 8765 is available on host 0.0.0.0
2025-04-26 21:37:21,188 - solr-mcp-server - INFO - Starting MCP server directly...
2025-04-26 21:37:21,190 - solr-mcp-server - INFO - Initializing MCP server resources...
2025-04-26 21:37:21,190 - solr-mcp-server - INFO - Testing Solr connection...
2025-04-26 21:37:21,213 - httpx - INFO - HTTP Request: GET http://localhost:8983/solr/documents/admin/ping "HTTP/1.1 200 OK"
2025-04-26 21:37:21,213 - solr-mcp-server - INFO - Solr connection successful
2025-04-26 21:37:32,218 - asyncio - ERROR - unhandled exception during asyncio.run() shutdown
task: <Task finished name='mcp.server.fastmcp.server.FastMCP.run_stdio_async' coro=<FastMCP.run_stdio_async() done, defined at /home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/anyio/_backends/_asyncio.py:2291> exception=ExceptionGroup('unhandled errors in a TaskGroup', [AttributeError("'FastMCP' object has no attribute 'state'")])>
  + Exception Group Traceback (most recent call last):
  |   File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 2298, in wrapper
  |     return await func(*args)
  |   File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/mcp/server/fastmcp/server.py", line 460, in run_stdio_async
  |     async with stdio_server() as (read_stream, write_stream):
  |   File "/home/mjochum/.local/share/uv/python/cpython-3.10.17-linux-x86_64-gnu/lib/python3.10/contextlib.py", line 217, in __aexit__
  |     await self.gen.athrow(typ, value, traceback)
  |   File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/mcp/server/stdio.py", line 83, in stdio_server
  |     async with anyio.create_task_group() as tg:
  |   File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | exceptiongroup.ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/mcp/server/stdio.py", line 86, in stdio_server
    |     yield read_stream, write_stream
    |   File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/mcp/server/fastmcp/server.py", line 461, in run_stdio_async
    |     await self._mcp_server.run(
    |   File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/mcp/server/lowlevel/server.py", line 484, in run
    |     lifespan_context = await stack.enter_async_context(self.lifespan(self))
    |   File "/home/mjochum/.local/share/uv/python/cpython-3.10.17-linux-x86_64-gnu/lib/python3.10/contextlib.py", line 619, in enter_async_context
    |     result = await _cm_type.__aenter__(cm)
    |   File "/home/mjochum/.local/share/uv/python/cpython-3.10.17-linux-x86_64-gnu/lib/python3.10/contextlib.py", line 199, in __aenter__
    |     return await anext(self.gen)
    |   File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/mcp/server/fastmcp/server.py", line 104, in wrap
    |     async with lifespan(app) as context:
    |   File "/home/mjochum/.local/share/uv/python/cpython-3.10.17-linux-x86_64-gnu/lib/python3.10/contextlib.py", line 199, in __aenter__
    |     return await anext(self.gen)
    |   File "/home/mjochum/projekte/solr-search/src/server.py", line 209, in lifespan
    |     app.state.solr_client = solr_client  # For mcp-server 0.1.4 compatibility
    | AttributeError: 'FastMCP' object has no attribute 'state'
    +------------------------------------
Starting MCP server on http://0.0.0.0:8765...
Traceback (most recent call last):
  File "/home/mjochum/projekte/solr-search/src/server.py", line 367, in <module>
    run_server_with_mcp_cli()
  File "/home/mjochum/projekte/solr-search/src/server.py", line 358, in run_server_with_mcp_cli
    app.run()  # Relies on environment variables set above
  File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/mcp/server/fastmcp/server.py", line 159, in run
    anyio.run(self.run_stdio_async)
  File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/anyio/_core/_eventloop.py", line 74, in run
    return async_backend.run(func, args, {}, backend_options)
  File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 2310, in run
    return runner.run(wrapper())
  File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 217, in run
    return self._loop.run_until_complete(task)
  File "/home/mjochum/.local/share/uv/python/cpython-3.10.17-linux-x86_64-gnu/lib/python3.10/asyncio/base_events.py", line 636, in run_until_complete
    self.run_forever()
  File "/home/mjochum/.local/share/uv/python/cpython-3.10.17-linux-x86_64-gnu/lib/python3.10/asyncio/base_events.py", line 603, in run_forever
    self._run_once()
  File "/home/mjochum/.local/share/uv/python/cpython-3.10.17-linux-x86_64-gnu/lib/python3.10/asyncio/base_events.py", line 1871, in _run_once
    event_list = self._selector.select(timeout)
  File "/home/mjochum/.local/share/uv/python/cpython-3.10.17-linux-x86_64-gnu/lib/python3.10/selectors.py", line 469, in select
    fd_event_list = self._selector.poll(timeout, max_ev)
  File "/home/mjochum/projekte/solr-search/.venv/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 257, in _on_sigint
    raise KeyboardInterrupt()
KeyboardInterrupt
Exception ignored in: <module 'threading' from '/home/mjochum/.local/share/uv/python/cpython-3.10.17-linux-x86_64-gnu/lib/python3.10/threading.py'>
Traceback (most recent call last):
  File "/home/mjochum/.local/share/uv/python/cpython-3.10.17-linux-x86_64-gnu/lib/python3.10/threading.py", line 1567, in _shutdown
    lock.acquire()
KeyboardInterrupt: 
Fatal Python error: _enter_buffered_busy: could not acquire lock for <_io.BufferedReader name='<stdin>'> at interpreter shutdown, possibly due to daemon threads
Python runtime state: finalizing (tstate=0x00005bdb3eaf98f0)

Current thread 0x00007b29ded9c740 (most recent call first):
  <no Python frame>
